<table class="table meal-plan-table">
  <thead>
    <tr>
      <th>Day</th>
      <% @meal_types.each do |type| %>
        <th><%= type.capitalize %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @days.each do |day| %>
      <tr>
        <td><%= day.strftime('%A, %b %d') %></td>
        <% @meal_types.each do |type| %>
          <td>
            <% meal_plan = @meal_plans[[day, type]]&.first %>
            <%= form_with url: update_plan_meal_plans_path, method: :post do |f| %>
              <%= f.hidden_field :date, value: day %>
              <%= f.hidden_field :meal_type, value: type %>
              
              <% available_meals = @meals_by_type[type] %>
              <%= f.select :meal_id,
                  options_for_select(
                    [['Select meal...', '']] + 
                    available_meals.map { |m| [m.name, m.id] },
                    meal_plan&.meal_id
                  ),
                  {},
                  class: 'form-control meal-select',
                  data: { submit_on_change: true }
              %>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>